{"version":3,"file":"Dialog-BCLqNB2K.js","sources":["../../../src/lib/Dialog.svelte"],"sourcesContent":["<script lang=\"ts\">\n  import { createEventDispatcher, onDestroy, onMount } from 'svelte';\n  import { CCLVividColor } from '$lib/const/config';\n  type VividVar = (typeof CCLVividColor)[keyof typeof CCLVividColor];\n\n  const isBrowser = typeof window !== 'undefined';\n\n  const dispatch = createEventDispatcher<{ close: void }>();\n\n  /**\n   * ダイアログの表示状態\n   */\n  export let open: boolean = false;\n\n  /**\n   * タイトル（スロット優先）。\n   */\n  export let title: string = '';\n\n  /**\n   * ESCキーで閉じるか\n   */\n  export let closeOnEsc: boolean = true;\n\n  /**\n   * オーバーレイ（外側クリック）で閉じるか\n   */\n  export let closeOnOutside: boolean = true;\n\n  /**\n   * アクセント色（境界線やタイトルに使用）\n   */\n  export let borderColor: VividVar = CCLVividColor.STRAWBERRY_PINK;\n\n  // ヘッダー背景は borderColor と共通化\n  let panelEl: HTMLElement | null = null;\n  let previouslyFocused: Element | null = null;\n  const titleId = `ccl-dialog-title-${Math.random().toString(36).substring(2, 9)}`;\n\n  function close() {\n    dispatch('close');\n  }\n\n  function onKeydown(e: KeyboardEvent) {\n    if (!open) return;\n    if (e.key === 'Escape' && closeOnEsc) {\n      e.stopPropagation();\n      close();\n    }\n    if (e.key === 'Tab') {\n      // 簡易フォーカストラップ\n      const focusable = panelEl?.querySelectorAll<HTMLElement>(\n        'a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex=\"-1\"])'\n      );\n      if (!focusable || focusable.length === 0) return;\n      const first = focusable[0];\n      const last = focusable[focusable.length - 1];\n      const active = document.activeElement as HTMLElement | null;\n      if (e.shiftKey) {\n        if (active === first || !panelEl?.contains(active)) {\n          e.preventDefault();\n          last.focus();\n        }\n      } else {\n        if (active === last) {\n          e.preventDefault();\n          first.focus();\n        }\n      }\n    }\n  }\n\n  function moveFocusIn() {\n    // 表示時にパネル内へフォーカス移動\n    previouslyFocused = document.activeElement;\n    const focusable = panelEl?.querySelector<HTMLElement>(\n      'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n    );\n    (focusable ?? panelEl)?.focus();\n  }\n\n  function restoreFocus() {\n    if (previouslyFocused instanceof HTMLElement) {\n      previouslyFocused.focus({ preventScroll: true });\n    }\n  }\n\n  function lockScroll() {\n    const original = document.documentElement.style.overflow;\n    document.documentElement.style.overflow = 'hidden';\n    return () => {\n      document.documentElement.style.overflow = original;\n    };\n  }\n\n  let unlockScroll: (() => void) | null = null;\n\n  onMount(() => {\n    const handle = (e: KeyboardEvent) => onKeydown(e);\n    window.addEventListener('keydown', handle, true);\n    return () => window.removeEventListener('keydown', handle, true);\n  });\n\n  $: if (isBrowser) {\n    if (open) {\n      // 表示されたときに実施\n      setTimeout(moveFocusIn, 0);\n      if (!unlockScroll) unlockScroll = lockScroll();\n    } else {\n      // 非表示に切り替わったとき\n      if (unlockScroll) {\n        unlockScroll();\n        unlockScroll = null;\n      }\n      restoreFocus();\n    }\n  }\n\n  onDestroy(() => {\n    if (unlockScroll) unlockScroll();\n  });\n</script>\n\n{#if open}\n  <!-- svelte-ignore a11y-click-events-have-key-events -->\n  <div\n    class=\"ccl-dialog-backdrop\"\n    role=\"presentation\"\n    on:click={() => {\n      if (closeOnOutside) close();\n    }}\n  >\n    <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->\n    <div\n      bind:this={panelEl}\n      class=\"ccl-dialog-panel\"\n      role=\"dialog\"\n      aria-modal=\"true\"\n      aria-labelledby={titleId}\n      style=\"--border-color: var({borderColor});\"\n      on:click|stopPropagation\n      tabindex=\"-1\"\n    >\n      <header class=\"ccl-dialog-header\">\n        <h2 id={titleId} class=\"ccl-dialog-title\">\n          <slot name=\"title\">{title}</slot>\n        </h2>\n        <button class=\"ccl-dialog-close\" aria-label=\"Close dialog\" on:click={close}> × </button>\n      </header>\n      <section class=\"ccl-dialog-body\">\n        <slot />\n      </section>\n      <footer class=\"ccl-dialog-footer\">\n        <slot name=\"footer\" />\n      </footer>\n    </div>\n  </div>\n{/if}\n\n<style>\n  .ccl-dialog-backdrop {\n    position: fixed;\n    inset: 0;\n    background: var(--wrap-grey);\n    display: grid;\n    place-items: center;\n    z-index: 1000;\n  }\n\n  .ccl-dialog-panel {\n    background: #fff;\n    border: 4px solid var(--border-color);\n    border-radius: 12px;\n    max-width: 640px;\n    width: calc(100% - 2rem);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);\n    color: var(--wrap-grey);\n    display: grid;\n    grid-template-rows: auto 1fr auto;\n    max-height: 85vh;\n    outline: none;\n  }\n\n  .ccl-dialog-header {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0.75rem 1rem;\n    border-bottom: 3px solid var(--border-color);\n    background: var(--border-color);\n    color: #fff;\n  }\n\n  .ccl-dialog-title {\n    margin: 0;\n    color: #fff;\n    font-size: 1.1rem;\n  }\n\n  .ccl-dialog-close {\n    background: var(--border-color);\n    border: 2px solid var(--border-color);\n    color: #fff;\n    border-radius: 8px;\n    width: 2.25rem;\n    height: 2.25rem;\n    cursor: pointer;\n    font-size: 1.5rem;\n    font-weight: 900;\n    line-height: 1;\n  }\n\n  .ccl-dialog-body {\n    padding: 1rem;\n    overflow: auto;\n  }\n\n  .ccl-dialog-footer {\n    padding: 0.75rem 1rem;\n    display: flex;\n    gap: 0.5rem;\n    justify-content: flex-end;\n  }\n</style>\n"],"names":["open","cov_5vufo7gd3","s","$","$$props","title","closeOnEsc","closeOnOutside","borderColor","titleId","Math","random","toString","substring","dispatch","onKeydown","e","f","b","key","stopPropagation","close","focusable","length","first","active","document","activeElement","panelEl","contains","last","focus","preventDefault","moveFocusIn","previouslyFocused","querySelector","restoreFocus","preventScroll","lockScroll","original","documentElement","style","overflow","onMount","window","addEventListener","handle","onDestroy","unlockScroll","isBrowser","setTimeout","div_1","$$value","div","$$render","consequent"],"mappings":"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"}